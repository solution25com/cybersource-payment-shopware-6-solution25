(()=>{"use strict";class e extends window.PluginBaseClass{init(){this._registerElements(),this._registerEvents(),this._registerPlaceholdeValidations()}_registerElements(){this.confirmOrderForm=document.forms[this.options.confirmFormId],this.orderSubmitButton=document.getElementById(this.options.submitButtonId),this.cardNumberField=document.getElementById(this.options.cardNumberFieldId),this.expiryField=document.getElementById(this.options.expiryFieldId),this.cvcField=document.getElementById(this.options.cvcFieldId),this.tosField=document.getElementById(this.options.tosFieldId),this.saveCardonFile=document.getElementById("cybersource_shopware6_save_card"),this.isSavedCardExists=document.getElementById("saved-cards"),this.cvcField.value="",this.expiryField.value="",this.cardNumberField.value="",null!=this.isSavedCardExists&&(this.saveCardonFile.checked=!1,this.SavedCardRadio=document.getElementsByName("cybersource_shopware6_saved_card"),this.newCreditCardFormContainer=document.querySelector(".cybersource_shopware6_container"),this.newCreditCardContainer=document.querySelector(".cybersource_shopware6_new_card_container"))}_registerEvents(){if(null!=this.isSavedCardExists){for(var e=0;e<this.SavedCardRadio.length;e++)this.SavedCardRadio[e].addEventListener("change",this._onSavedCardRadioChange.bind(this)),this.SavedCardRadio[0].checked=!0;this.SavedCardRadio.length<=1?(this.newCreditCardFormContainer.style.display="block",this.newCreditCardContainer.style.display="none"):(this.newCreditCardFormContainer.style.display="none",this.newCreditCardContainer.style.display="block")}this.confirmOrderForm.addEventListener("click",this._onOrderSubmitButtonClick.bind(this))}_onOrderSubmitButtonClick(e){return e.preventDefault(),!!this._validateForm()&&(this.confirmOrderForm.submit(),!0)}_onSavedCardRadioChange(e){"cybersource_shopware6_new_credit_card"===e.target.value&&!0===e.target.checked?this.newCreditCardFormContainer.style.display="block":this.newCreditCardFormContainer.style.display="none"}_validateForm(){return null==this.tosField||this.tosField.checkValidity()?(!this.isNewCardChecked()||!!this.checkRequired([this.cardNumberField,this.expiryField,this.cvcField]))&&(this.isNewCardChecked()&&!this.isValidCreditCardNumber()?(this.addErrorClass(this.cardNumberField,this.getErrorMessage(this.cardNumberField)),this.cardNumberField.focus(),!1):(this.removeErrorClass(this.cardNumberField),this.isNewCardChecked()&&!this.isValidExpiryDate())?(this.addErrorClass(this.expiryField,this.getErrorMessage(this.expiryField)),this.expiryField.focus(),!1):(this.removeErrorClass(this.expiryField),this.isNewCardChecked()&&!this.isValidCVC())?(this.addErrorClass(this.cvcField,this.cvcField.getAttribute("data-error-msg")),this.cvcField.focus(),!1):(this.removeErrorClass(this.cvcField),!0)):(this.tosField.classList.add("is-invalid"),!1)}isNewCardChecked(){let e=!1;if(null==this.isSavedCardExists)return!0;for(let r of this.SavedCardRadio)r.checked&&"cybersource_shopware6_new_credit_card"===r.value&&(e=!0);return 1===this.SavedCardRadio.length||!0===e}isValidCreditCardNumber(){let e=this.cardNumberField.value.replace(/\D/g,"");return this.options.cardNumberRegex.test(e)}isValidExpiryDate(){return this.isValidExpiryMonth()&&this.isValidExpiryYear()}isValidExpiryMonth(){let e=this.expiryField.value.split("/"),r=parseInt(e[0],10);return!(2!==e.length||isNaN(r))&&!(r<1)&&!(r>12)}isValidExpiryYear(){let e=new Date().getFullYear()%100,r=parseInt(this.expiryField.value.split("/")[1],10);return!isNaN(r)&&!(r<e)&&!(r>e+10)}isValidCVC(){return this.options.cvcNumberRegex.test(this.cvcField.value)}addErrorClass(e,r){let i=e.parentElement;i.className="form-group error",i.querySelector(this.options.errorMsgContainer).innerHTML=r}removeErrorClass(e){let r=e.parentElement;r.className="form-group",r.querySelector(this.options.errorMsgContainer).innerText=""}checkRequired(e){let r=!0,i=null;return e.forEach(e=>{""===e.value.trim()?(this.addErrorClass(e,this.getRequiredMessage(e)),i||(i=e),r=!1):this.removeErrorClass(e)}),i&&i.focus(),r}getErrorMessage(e){return e.getAttribute("data-error-msg")}getRequiredMessage(e){return e.getAttribute("data-required-msg")}_registerPlaceholdeValidations(){let{formatCreditCard:e,formatDate:r,registerCursorTracker:i,DefaultCreditCardDelimiter:t,DefaultDateDelimiter:s}=window.cleaveZen;i({input:this.cardNumberField,delimiter:t}),this.cardNumberField.addEventListener("input",r=>{this.cardNumberField.value=e(r.target.value)}),i({input:this.expiryField,delimiter:s}),this.expiryField.addEventListener("input",e=>{this.expiryField.value=r(e.target.value,{datePattern:["m","y"]})})}}e.options={confirmFormId:"confirmOrderForm",submitButtonId:"confirmFormSubmit",cardNumberFieldId:"cybersource_shopware6_card_no",expiryFieldId:"cybersource_shopware6_expiry_date",cvcFieldId:"cybersource_shopware6_security_code",tosFieldId:"tos",errorMsgContainer:"small",cardNumberRegex:/^(?:\d{14}|\d{15}|\d{16}|\d{18}|\d{19})$/,cvcNumberRegex:/^(?:\d{3}|\d{4})$/},window.PluginManager.register("CyberSourceShopware6CreditCard",e,"[data-cybersource-payment-base]")})();